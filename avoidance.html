<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The avoidance problem - Counterexamples in Type Systems</title>
        
        


        <!-- Custom HTML head -->
        <!-- KaTeX stylesheet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">

<style>
pre[data-codetab=hide] { display: none; }
pre[data-codetab] { margin-top: 0 }
.error { color: #f00; }
.codetab-bar button {
  background-color: inherit;
  border: none;
  cursor: pointer;
}
.codetab-bar button:hover {
  background-color: #ddd;
}
.codetab-bar button[data-codetab=show] {
  background-color: #ccc;
}
</style>

<script>
function langName(node) {
  let lang = node.querySelector('code[class^="language-"]');
  if (lang) lang = lang.className.match(/language-(\w+)/)[1];
  lang = lang ? lang : "code";
  lang = lang.replace(/^\w/, s => s.toUpperCase());
  lang = {Ocaml:"OCaml","_rust":"Rust","Sml":"Standard ML","Typescript":"TypeScript","Csharp":"C#"}[lang] || lang;
  return lang;
}
function insertCodeTabs() {
  while (true) {
    let code = document.querySelector('pre:not([data-codetab])');
    if (!code) return;
    let bar = document.createElement("DIV");
    bar.classList.add('codetab-bar');
    let tabs = [], buttons = [];
    while (code && code.nodeName == "PRE") {
      let button = document.createElement('BUTTON');
      button.innerHTML = langName(code);
      tabs.push(code);
      buttons.push(button);
      bar.appendChild(button);
      code = code.nextElementSibling;
    }
    tabs[0].parentNode.insertBefore(bar, tabs[0]);
    let select = function(t,b) {
      tabs.forEach(t => t.dataset.codetab="hide");
      buttons.forEach(b => b.dataset.codetab="hide");
      t.dataset.codetab = "show";
      b.dataset.codetab = "show";
    };
    for (var i = 0; i < tabs.length; i++) {
      let ix = i;
      buttons[ix].addEventListener('click', ev => select(tabs[ix], buttons[ix]));
    }
    select(tabs[0], buttons[0]);
  }
}
document.addEventListener('DOMContentLoaded', insertCodeTabs);
</script>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 450) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="title.html">Counterexamples in Type Systems</a></li><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="glossary.html">Index and Glossary</a></li><li class="chapter-item expanded "><a href="polymorphic-references.html"><strong aria-hidden="true">1.</strong> Polymorphic references</a></li><li class="chapter-item expanded "><a href="general-covariance.html"><strong aria-hidden="true">2.</strong> Covariant containers</a></li><li class="chapter-item expanded "><a href="incomplete-variance.html"><strong aria-hidden="true">3.</strong> Incomplete variance checking</a></li><li class="chapter-item expanded "><a href="under-construction.html"><strong aria-hidden="true">4.</strong> Objects under construction</a></li><li class="chapter-item expanded "><a href="currys-paradox.html"><strong aria-hidden="true">5.</strong> Curry's paradox</a></li><li class="chapter-item expanded "><a href="eventually-nothing.html"><strong aria-hidden="true">6.</strong> Eventually, nothing</a></li><li class="chapter-item expanded "><a href="dubious-evidence.html"><strong aria-hidden="true">7.</strong> Dubious evidence</a></li><li class="chapter-item expanded "><a href="anythings.html"><strong aria-hidden="true">8.</strong> Some kinds of Anything</a></li><li class="chapter-item expanded "><a href="anything-once.html"><strong aria-hidden="true">9.</strong> Any (single) thing</a></li><li class="chapter-item expanded "><a href="mutable-matching.html"><strong aria-hidden="true">10.</strong> Mutable matching</a></li><li class="chapter-item expanded "><a href="runtime-misinformation.html"><strong aria-hidden="true">11.</strong> Runtime type misinformation</a></li><li class="chapter-item expanded "><a href="overloading-polymorphism.html"><strong aria-hidden="true">12.</strong> Overloading and polymorphism</a></li><li class="chapter-item expanded "><a href="distinctness-injectivity.html"><strong aria-hidden="true">13.</strong> Distinctness I: Injectivity</a></li><li class="chapter-item expanded "><a href="distinctness-recursion.html"><strong aria-hidden="true">14.</strong> Distinctness II: Recursion</a></li><li class="chapter-item expanded "><a href="distinctness-options.html"><strong aria-hidden="true">15.</strong> Distinctness III: Options</a></li><li class="chapter-item expanded "><a href="subtyping-vs-inheritance.html"><strong aria-hidden="true">16.</strong> Subtyping vs. inheritance</a></li><li class="chapter-item expanded "><a href="selfishness.html"><strong aria-hidden="true">17.</strong> Selfishness</a></li><li class="chapter-item expanded "><a href="privacy-violation.html"><strong aria-hidden="true">18.</strong> Privacy violation</a></li><li class="chapter-item expanded "><a href="unstable-types.html"><strong aria-hidden="true">19.</strong> Unstable type expressions</a></li><li class="chapter-item expanded "><a href="avoidance.html" class="active"><strong aria-hidden="true">20.</strong> The avoidance problem</a></li><li class="chapter-item expanded "><a href="little-knowledge.html"><strong aria-hidden="true">21.</strong> A little knowledge...</a></li><li class="chapter-item expanded "><a href="underdetermined-recursion.html"><strong aria-hidden="true">22.</strong> Underdetermined recursion</a></li><li class="chapter-item expanded "><a href="overdetermined-recursion.html"><strong aria-hidden="true">23.</strong> Overdetermined recursion</a></li><li class="chapter-item expanded "><a href="scope-escape.html"><strong aria-hidden="true">24.</strong> Scope escape</a></li><li class="chapter-item expanded "><a href="false-pretenses.html"><strong aria-hidden="true">25.</strong> Under false pretenses</a></li><li class="chapter-item expanded "><a href="suspicious-subterms.html"><strong aria-hidden="true">26.</strong> Suspicious subterms</a></li><li class="chapter-item expanded "><a href="only-one-leibniz.html"><strong aria-hidden="true">27.</strong> There's only one Leibniz</a></li><li class="chapter-item expanded "><a href="intersecting-references.html"><strong aria-hidden="true">28.</strong> Intersecting references</a></li><li class="chapter-item expanded "><a href="polymorphic-union-refinement.html"><strong aria-hidden="true">29.</strong> Polymorphic union refinement</a></li><li class="chapter-item expanded "><a href="strict-positivity.html"><strong aria-hidden="true">30.</strong> Positivity, strict and otherwise</a></li><li class="chapter-item expanded "><a href="nearly-universal.html"><strong aria-hidden="true">31.</strong> Nearly-universal quantification</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Counterexamples in Type Systems</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/stedolan/counterexamples" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#the-avoidance-problem" id="the-avoidance-problem">The avoidance problem</a></h1>
<p><small><a href="glossary.html#scoping">[scoping]</a> <a href="glossary.html#subtyping">[subtyping]</a></small></p>
<p>A type system which infers types can occasionally find itself having
inferred a type that refers to something (a type, module, etc.) which
is about to go out of scope. Referring to things which are no longer
in scope is ill-formed, and doing it generally leads to unsoundness
(see <a href="scope-escape.html">Scope escape</a>).</p>
<p>So, the type system must approximate the desired type, using only
what's still in scope and avoiding the names going out of scope, which
is known as the <em>avoidance problem</em>. This is hard, and in most type
systems there is no general way to do it, and some systems employ
fragile heuristics.</p>
<p>An example of this due to Dreyer<sup class="footnote-reference"><a href="#dreyer">1</a></sup> can be found in OCaml, when a
parameterised module is instantiated with an anonymous module:</p>
<pre><code class="language-ocaml">module type S = sig type t end
module F (X : S) = struct type u = X.t type v = X.t end
module AppF = F((struct type t = int end : S))
</code></pre>
<p>Here OCaml infers the following module signature for <code>AppF</code>:</p>
<pre><code class="language-ocaml">module AppF : sig type u type v end
</code></pre>
<p>The type <code>X.t</code> is no longer in scope as the anonymous module
substituted for <code>X</code> has no name. So the signature is approximated by
leaving the types abstract. However, if the definition of <code>F</code> is
changed to an equivalent form:</p>
<pre><code class="language-ocaml">module G (X : S) = struct type u = X.t type v = u end
</code></pre>
<p>then the inferred module signature changes to the non-equivalent:</p>
<pre><code class="language-ocaml">module AppG : sig type u type v = u end
</code></pre>
<p>The approximation process fails to respect equivalences between module
signatures, which is typical of heuristic solutions to the avoidance
problem.</p>
<p>A well-behaved solution to the avoidance problem is to introduce
existential types when necessary to give names to values that have
gone out of scope. In the above example, that would lead to a
signature like <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∃</mi><mi mathvariant="sans-serif">X</mi><mo>:</mo><mi mathvariant="sans-serif">S</mi><mi mathvariant="normal">.</mi><mtext>  </mtext><mo stretchy="false">{</mo><mrow><mi mathvariant="monospace">t</mi><mi mathvariant="monospace">y</mi><mi mathvariant="monospace">p</mi><mi mathvariant="monospace">e</mi></mrow><mtext>  </mtext><mi mathvariant="monospace">u</mi><mo>=</mo><mi mathvariant="sans-serif">X</mi><mi mathvariant="normal">.</mi><mi mathvariant="monospace">t</mi><mo separator="true">;</mo><mtext>  </mtext><mrow><mi mathvariant="monospace">t</mi><mi mathvariant="monospace">y</mi><mi mathvariant="monospace">p</mi><mi mathvariant="monospace">e</mi></mrow><mtext>  </mtext><mi mathvariant="monospace">v</mi><mo>=</mo><mi mathvariant="sans-serif">X</mi><mi mathvariant="normal">.</mi><mi mathvariant="monospace">t</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">∃\n{X} : \n{S}.;{ {\tt type};{\tt u} = \n{X}.{\tt t};; {\tt type}; {\tt v} = \n{X}.{\tt t} }</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord">∃</span><span class="mord"><span class="mord mathsf">X</span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">S</span></span><span class="mord">.</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">{</span><span class="mord"><span class="mord"><span class="mord mathtt">t</span><span class="mord mathtt">y</span><span class="mord mathtt">p</span><span class="mord mathtt">e</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord"><span class="mord mathtt">u</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.9166599999999999em;vertical-align:-0.22222em;"></span><span class="mord"><span class="mord mathsf">X</span></span><span class="mord">.</span><span class="mord"><span class="mord"><span class="mord mathtt">t</span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathtt">t</span><span class="mord mathtt">y</span><span class="mord mathtt">p</span><span class="mord mathtt">e</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord"><span class="mord mathtt">v</span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">X</span></span><span class="mord">.</span><span class="mord"><span class="mord"><span class="mord mathtt">t</span></span></span><span class="mclose">}</span></span></span></span>.
The details of when and how to introduce such existentials can be
quite tricky, see Crary<sup class="footnote-reference"><a href="#crary">2</a></sup> for a recent approach.</p>
<p>Languages with subtyping and top/bottom types <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">A</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">y</mi></mrow><annotation encoding="application/x-tex">\n{Any}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">A</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">y</span></span></span></span></span> and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">h</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">g</mi></mrow><annotation encoding="application/x-tex">\n{Nothing}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">N</span><span class="mord mathsf">o</span><span class="mord mathsf">t</span><span class="mord mathsf">h</span><span class="mord mathsf">i</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">g</span></span></span></span></span> can
sometimes use a different solution to the avoidance problem: types that go out
of scope are approximated as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">A</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">y</mi></mrow><annotation encoding="application/x-tex">\n{Any}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">A</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">y</span></span></span></span></span> when used covariantly (as an
output) and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">h</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">g</mi></mrow><annotation encoding="application/x-tex">\n{Nothing}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">N</span><span class="mord mathsf">o</span><span class="mord mathsf">t</span><span class="mord mathsf">h</span><span class="mord mathsf">i</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">g</span></span></span></span></span> when used contravariantly (as an input). For
instance, when the type <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> goes out of scope, a function of type
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="sans-serif">L</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">s</mi><mi mathvariant="sans-serif">t</mi></mrow><mo stretchy="false">[</mo><mi>A</mi><mo stretchy="false">]</mo><mo>→</mo><mrow><mi mathvariant="sans-serif">L</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">s</mi><mi mathvariant="sans-serif">t</mi></mrow><mo stretchy="false">[</mo><mi>A</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\n{List}[A] → \n{List}[A]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">L</span><span class="mord mathsf">i</span><span class="mord mathsf">s</span><span class="mord mathsf">t</span></span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">L</span><span class="mord mathsf">i</span><span class="mord mathsf">s</span><span class="mord mathsf">t</span></span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose">]</span></span></span></span> becomes <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi mathvariant="sans-serif">L</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">s</mi><mi mathvariant="sans-serif">t</mi></mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">h</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">g</mi></mrow><mo stretchy="false">]</mo><mo>→</mo><mrow><mi mathvariant="sans-serif">L</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">s</mi><mi mathvariant="sans-serif">t</mi></mrow><mo stretchy="false">[</mo><mrow><mi mathvariant="sans-serif">A</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">y</mi></mrow><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">\n{List}[\n{Nothing}] → \n{List}[\n{Any}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">L</span><span class="mord mathsf">i</span><span class="mord mathsf">s</span><span class="mord mathsf">t</span></span><span class="mopen">[</span><span class="mord"><span class="mord mathsf">N</span><span class="mord mathsf">o</span><span class="mord mathsf">t</span><span class="mord mathsf">h</span><span class="mord mathsf">i</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">g</span></span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathsf">L</span><span class="mord mathsf">i</span><span class="mord mathsf">s</span><span class="mord mathsf">t</span></span><span class="mopen">[</span><span class="mord"><span class="mord mathsf">A</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">y</span></span><span class="mclose">]</span></span></span></span>.</p>
<p>Scala uses this approach. However, due to the presence of constraints
in Scala types (a type <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo stretchy="false">[</mo><mi>A</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">T[A]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mopen">[</span><span class="mord mathnormal">A</span><span class="mclose">]</span></span></span></span> may be well-defined only for some <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span>),
it is not always valid to replace occurrences of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal">A</span></span></span></span> with <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">A</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">y</mi></mrow><annotation encoding="application/x-tex">\n{Any}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">A</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">y</span></span></span></span></span> or
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">o</mi><mi mathvariant="sans-serif">t</mi><mi mathvariant="sans-serif">h</mi><mi mathvariant="sans-serif">i</mi><mi mathvariant="sans-serif">n</mi><mi mathvariant="sans-serif">g</mi></mrow><annotation encoding="application/x-tex">\n{Nothing}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord"><span class="mord mathsf">N</span><span class="mord mathsf">o</span><span class="mord mathsf">t</span><span class="mord mathsf">h</span><span class="mord mathsf">i</span><span class="mord mathsf">n</span><span class="mord mathsf" style="margin-right:0.01389em;">g</span></span></span></span></span>.  This caused a bug in Scala<sup class="footnote-reference"><a href="#scala">3</a></sup>, where invalid types were
sometimes inferred:</p>
<pre><code class="language-scala">// Counterexample by Guillaume Martres
class Contra[-T &gt;: Null]

object Test {
  def foo = {
    class A
    new Contra[A]
  }
}
// The inferred type of foo is Contra[Nothing],
// but this isn't a legal type
</code></pre>
<div class="footnote-definition" id="dreyer"><sup class="footnote-definition-label">1</sup>
<p>Fig 4.12 on p. 79 of <a href="https://www.cs.cmu.edu/%7Erwh/theses/dreyer.pdf">Understanding and Evolving the ML
Module System</a>, Derek
Dreyer (2005)</p>
</div>
<div class="footnote-definition" id="crary"><sup class="footnote-definition-label">2</sup>
<p><a href="https://www.cs.cmu.edu/%7Ecrary/papers/2020/exsig.pdf">A Focused Solution to the Avoidance Problem</a>, Karl Crary (2020)</p>
</div>
<div class="footnote-definition" id="scala"><sup class="footnote-definition-label">3</sup>
<p><a href="https://github.com/lampepfl/dotty/issues/6205">https://github.com/lampepfl/dotty/issues/6205</a> (2019)</p>
</div>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="unstable-types.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="little-knowledge.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="unstable-types.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="little-knowledge.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
